---
author: "Alex Smith"
date: "2/8/2017"
output: html_document
---

Compare optimal selection across strategies


```{r setup, include=FALSE}

rm(list=ls())

library(colorRamps)
library(tidyverse)

sapply(list.files(pattern="[.]R$", path="./Functions", full.names=TRUE), source)

```

```{r load_data, warning=FALSE}

# Full Model Output

effort = read_csv("./data/Model_Output/Out_Effort.csv")

selectivity =  read_csv("./data/Model_Output/Out_Selectivity.csv")

seasonal =  read_csv("./data/Model_Output/Out_Season.csv")

closure = read_csv("./data/Model_Output/Out_closure.csv")

#combined = read_csv("./data/Model_Output/Out_Combined.csv")

#NPV

NPV_effort = read.csv( "./data/Model_Output/NPV_Effort.csv") %>%
  mutate(Type = "effort") %>%
  rename(Value = F.Mortality)

NPV_selectivity = read.csv( "./data/Model_Output/NPV_Selectivity.csv") %>%
  mutate(Type = "selectivity") %>%
  rename(Value = Selectivity)

NPV_seasonal = read.csv( "./data/Model_Output/NPV_Season.csv") %>%
  mutate(Type = "seasonal") %>%
  rename(Value = Months.closed)

NPV_closure = read.csv( "./data/Model_Output/NPV_closure.csv") %>%
  mutate(Type = "closure") %>%
  rename(Value = YearsClosed)

# NPV_combined = read.csv( "./data/Model_Output/NPV_Combined.csv") %>%
#   mutate(Type = "combined") %>%
#   rename(Value = Label)
  
NPV_all = rbind(NPV_effort[,-1], NPV_seasonal[, -1], NPV_selectivity[,-1], NPV_closure[,-1])

#, NPV_combined[, c(6,5,7)]

```

```{r boxplot}

#pdf("./plots/compare_NPV.pdf") 

p =ggplot(NPV_all, aes(factor(Type), NPV)) +
    geom_boxplot() +
    geom_hline(yintercept = 0, alpha = 0.5, lty = 2) +
    labs(x = "Management Intervention") +
    scale_y_continuous(breaks = c(seq(-15000,17000,5000)))

MyTheme(p)

#dev.off()
```


```{r barplot}
p = NPV_all %>%
  group_by(Type) %>%
  summarise(opt = max(NPV)) %>%
  
  ggplot(aes(factor(Type), opt)) +
    geom_bar( stat = "identity") +
    geom_hline(yintercept = 0, alpha = 0.5, lty = 2) +
    labs(x = "Management Intervention") 
   # scale_y_continuous(breaks = c(seq(-15000,17000,5000)))

MyTheme(p)
```


```{r opt_PV}




seasonal_opt = seasonal %>%
  filter(Months.closed == NPV_seasonal$Value[which.max(NPV_seasonal$NPV)]) %>%
  mutate(PV = PresentValue(Profit, discount = 0.09, year)) %>%
  mutate(Type = "Seasonal Closure")

selectivity_opt = selectivity %>%
  filter(Selectivity == NPV_selectivity$Value[which.max(NPV_selectivity$NPV)]) %>%
  mutate(PV = PresentValue(Profit, discount = 0.09, year))%>%
  mutate(Type = "Gear Selectivity")

effort_opt = effort %>%
  filter(F.Mortality == NPV_effort$Value[which.max(NPV_effort$NPV)]) %>%
  mutate(PV = PresentValue(Profit, discount = 0.09, year)) %>%
  mutate(Type = "Effort Reduction")

closure_opt = closure %>%
  filter(YearsClosed == NPV_closure$Value[which.max(NPV_closure$NPV)]) %>%
  mutate(PV = PresentValue(Profit, discount = 0.09, year)) %>%
  mutate(Type = "Longterm Closure")

# combined_opt = combined %>%
#   filter(Months.closed == NPV_combined$Months.closed[which.max(NPV_combined$NPV)], 
#          Selectivity == NPV_combined$Selectivity[which.max(NPV_combined$NPV)], 
#          F.Mortality == NPV_combined$F.Mortality[which.max(NPV_combined$NPV)]) %>%
#   mutate(PV = PresentValue(Profit, discount = 0.09, year)) %>%
#   mutate(Type = "Combined")


PV_plot = rbind(seasonal_opt[, c(4, 26,27, 28)], 
                selectivity_opt[, c(4,26, 27, 28)], 
                effort_opt[, c(4, 26, 27, 28)],
                closure_opt[, c(3, 25, 26, 27)])
#,
 #               combined_opt[, c(6,28:30)])
#pdf("./plots/compare_opt.pdf")                    

p = ggplot(PV_plot, aes( year, PV, group = Type)) +
  geom_hline(yintercept = 0, alpha = 0.5, lty = 2) + 
  geom_line(aes(color = Type), size =1, alpha = 0.7) +
  #scale_y_continuous(breaks = c(seq(-100,2000,300))) +
  labs(x = "Time (years)", y = "Discounted profits (USD)", color = "Management \nIntervention") +
  theme_minimal()

MyTheme(p)  

#dev.off()
```



```{r opt_Real}


#pdf("./plots/compare_opt.pdf")                    

p = ggplot(PV_plot, aes( year, (Profit/1000), group = Type)) +
  geom_hline(yintercept = 0, alpha = 0.5, lty = 2) + 
  geom_line(aes(color = Type), size =1 ) +
  #scale_y_continuous(breaks = c(seq(-100,4000,600))) +
  scale_x_continuous(breaks = c(seq(0,20, 2))) +
  labs(x = "Time (years)", y = "Real Profits (thousand USD)", color = "Management \nIntervention") +
  theme_minimal()

MyTheme(p)  

#dev.off()
```

```{r opt_Real}


#pdf("./plots/compare_opt.pdf") 



currents <- c(0.3, 32)



#effort

curr_eff <- 0.3
comp_eff <- 0.3*0.5
NPV_curr_eff <- NPV_all[which(NPV_all$Value == curr_eff & NPV_all$Type == "effort"), 2]
NPV_comp_eff <- NPV_all[which(NPV_all$Value == comp_eff & NPV_all$Type == "effort"), 2]


#selectivity

curr_sel <- 32
comp_sel <- 65
NPV_curr_sel <- NPV_all[which(NPV_all$Value == curr_eff & NPV_all$Type == "selectivity"), 2]
NPV_comp_sel <- NPV_all[which(NPV_all$Value == comp_eff & NPV_all$Type == "effort"), 2]

#seasonal closure

comp_season <- 3
NPV_comp_eff <- NPV_all[which(NPV_all$Value == comp_eff & NPV_all$Type == "effort"), 2]





p = NPV_all %>%
  group_by(Type) %>%
  summarise(opt = max(NPV)) %>%

p = ggplot(PV_plot, aes( year, (Profit/1000), group = Type)) +
  geom_hline(yintercept = 0, alpha = 0.5, lty = 2) + 
  geom_line(aes(color = Type), size =1 ) +
  #scale_y_continuous(breaks = c(seq(-100,4000,600))) +
  scale_x_continuous(breaks = c(seq(0,20, 2))) +
  labs(x = "Time (years)", y = "Real Profits (thousand USD)", color = "Management \nIntervention") +
  theme_minimal()

MyTheme(p)  

#dev.off()
```
